const fs = require('fs');
const path = require('path');

// Parse CSV with multiline support
function parseCSV(content) {
    const rows = [];
    let currentRow = [];
    let currentField = '';
    let inQuotes = false;

    for (let i = 0; i < content.length; i++) {
        const char = content[i];
        const nextChar = content[i + 1];

        if (char === '"') {
            if (inQuotes && nextChar === '"') {
                currentField += '"';
                i++;
            } else {
                inQuotes = !inQuotes;
            }
        } else if (char === ',' && !inQuotes) {
            currentRow.push(currentField);
            currentField = '';
        } else if (char === '\n' && !inQuotes) {
            currentRow.push(currentField);
            rows.push(currentRow);
            currentRow = [];
            currentField = '';
        } else if (char === '\r' && !inQuotes) {
            // Skip
        } else {
            currentField += char;
        }
    }

    if (currentField || currentRow.length > 0) {
        currentRow.push(currentField);
        rows.push(currentRow);
    }

    return rows;
}

// Escape CSV field
function escapeCSV(field) {
    if (!field) return '';
    if (field.includes(',') || field.includes('"') || field.includes('\n')) {
        return '"' + field.replace(/"/g, '""') + '"';
    }
    return field;
}

// Story templates by category and type
const stories = {
    // 인건비 (4-19)
    4: `(주)퓨처테크의 이담당 대리는 연구개발계획서 작성 시 인건비를 대략 잡았습니다.

'대충 연봉 5천만원 정도로 잡으면 되겠지?'

실제 해당 연구원의 연봉은 4천만원. 차액 1천만원씩 12개월... 정산 시즌이 되자,

'실제 급여보다 과다하게 산정된 인건비는 불인정입니다.'

이 대리는 "대략적으로"의 대가를 톡톡히 치렀습니다.`,

    5: `A연구소의 김부장은 인건비 산정 시 좋은 아이디어가 떠올랐습니다.

'엔지니어링 단가가 시중 급여보다 높잖아? 이걸로 계산하면 인건비를 더 받을 수 있겠는데?'

참여연구원들의 실제 월급은 400만원인데, 엔지니어링 단가로는 600만원. 매달 200만원씩 차익!

정산 결과가 나왔습니다.

'인건비는 실지급 급여 기준입니다. 엔지니어링 단가 적용분 전액 불인정.'

김부장의 "좋은 아이디어"는 불인정으로 끝났습니다.`,

    6: `○○대학교 연구실의 박조교는 인건비 기준단가표를 보다가 착각했습니다.

'이 연구원은 3급이니까... 여기 3급 단가를 적용하면 되겠네!'

그런데 실제로는 4급 단가를 적용했어야 했습니다. 한 달에 30만원 차이... 12개월이면 360만원.

'기준단가 잘못 적용하셨습니다. 초과 집행분 불인정이요.'

박조교는 단가표를 다시 꼼꼼히 읽어보았습니다.`,

    7: `(주)스마트솔루션의 최과장은 인건비를 산정하면서 모든 걸 넣었습니다.

'기본급에 주휴수당, 식대, 복지포인트까지... 다 월급이니까 당연히 포함이지!'

문제는 복지포인트가 급여대장에 없이 별도로 지급되는 항목이었습니다.

'급여대장에 기재되지 않은 복지포인트는 통상 월급여가 아닙니다. 해당 금액 불인정.'

최과장은 "급여대장 기준"의 중요성을 깨달았습니다.`,

    8: `미래연구소의 정팀장은 퇴사한 연구원의 퇴직급여충당금을 보고 고민했습니다.

'1년 안 돼서 퇴사했으니 퇴직금은 안 줘도 되고... 적립된 충당금은 그냥 기관으로 가져가도 되겠지?'

연구 종료 후, 기관계정으로 슬쩍 흡수했습니다.

'퇴직급여충당금은 퇴직금 용도입니다. 지급사유가 없어졌으면 연구개발비로 복원하셔야죠. 불인정.'

정팀장은 "충당금은 충당금의 용도대로"라는 교훈을 얻었습니다.`,

    9: `한국기술원의 오매니저는 출산휴가 중인 연구원의 인건비를 처리했습니다.

'출산휴가여도 어쨌든 우리 직원이니까 급여 전액을 인건비로 넣으면 되겠지?'

그런데 고용보험에서 출산휴가급여 210만원을 지원받고 있었습니다.

'정부 지원금 받는 부분은 인건비에서 제외해야죠. 중복 수령이잖아요. 불인정입니다.'

오매니저는 이중수령의 함정에 빠진 것입니다.`,

    10: `(주)테크랩의 한대리는 육아휴직 중인 연구원 처리에 고민이 많았습니다.

'휴직 중이어도 4대보험 기관부담금이랑 퇴직충당금은 나가잖아... 인건비에서 처리해야지.'

현금 인건비로 해당 금액을 집행했습니다.

'육아휴직 기간 중 4대보험 기관부담금과 퇴직충당금은 인건비가 아니라 간접비에서 처리하셔야 합니다.'

한대리는 직접비와 간접비의 구분을 공부해야 했습니다.`,

    11: `A비영리기관의 배담당은 인건비 기관부담금을 정리하다가 주민세도 넣었습니다.

'4대보험 기관부담금에 주민세 종업원분도 넣으면... 다 비용이니까 괜찮겠지?'

'주민세 종업원분은 4대보험이 아닙니다. 간접비 중 연구지원비로 처리하셔야 해요. 불인정.'

배담당은 4대보험의 정확한 범위를 다시 확인했습니다.`,

    12: `○○대학교 산학협력단 소속 행정직원 A씨. 연구과제 지원 업무를 맡게 되었습니다.

'연구지원 업무하니까 인건비에서 받아도 되겠지?'

산학협력단이 아닌 연구부서(단과대, 학부, 연구소 등) 소속이어야 인건비 사용이 가능했습니다.

'산학협력단 소속은 인건비 대상이 아닙니다. 불인정.'

소속 부서의 중요성을 깨달은 순간이었습니다.`,

    13: `정부부처 공무원 A씨가 외부 연구과제에 참여하게 되었습니다.

'나도 연구 참여하니까 인건비 받으면 되겠네!'

현금 인건비로 계상하고 지급받았습니다.

'공무원은 원 소속기관에서 100% 급여를 받고 계시잖아요. 현금 인건비 계상 불가입니다. 전액 불인정.'

공무원의 현금인건비 제한을 몰랐던 것이 화근이었습니다.`,

    15: `(주)이노텍의 양과장은 연구원 한 명이 퇴사하자 바로 대체 인력을 투입했습니다.

'어차피 똑같이 일하는 거니까 인건비도 그냥 집행하면 되겠지.'

문제는 IRIS에 변경 등록을 하지 않은 것. 정산 시즌이 되자,

'이 연구원은 참여연구원으로 등록되어 있지 않습니다. 해당 인건비 불인정.'

양과장은 IRIS 등록의 중요성을 뼈저리게 느꼈습니다.`,

    16: `A영리기관은 B기관 소속 김박사를 외부참여자로 섭외했습니다.

'김박사님, 저희 과제 도와주시면 인건비 드릴게요!'

인건비는 지급했는데, B기관의 기관장 확인서를 받지 않았습니다.

'외부참여자는 원 소속기관의 기관장 확인서가 필수입니다. 확인서 없이 지급한 인건비 불인정.'

서류 하나가 큰 비용으로 돌아왔습니다.`,

    17: `B기관 소속 이연구원은 원 소속기관에서 월급 100%를 받고 있습니다. A기관의 연구과제에 참여하면서,

'추가로 인건비 받으면 좋겠다!'

A기관에서 현금 인건비를 지급했습니다.

'원 소속기관에서 100% 급여를 받는 분은 현물 인건비만 가능합니다. 현금 불인정.'

100% 급여 수령자의 현금인건비 제한을 몰랐던 것입니다.`,

    18: `(주)미래기술은 신규채용 인건비 예산을 잡아뒀는데, 적합한 인력을 구하기 어려웠습니다.

'그냥 기존 연구원들한테 나눠주면 되지 뭐. 어차피 총액은 같잖아.'

전문기관 승인 없이 기존인력에게 지급했습니다.

'신규인력 현금인건비 감액은 사전승인 대상입니다. 불인정.'

신규인력 예산의 특별한 관리 의무를 알게 되었습니다.`,

    19: `연구원이 중간에 바뀌었는데, 바쁜 나머지 IRIS 등록을 깜빡했습니다.

'어차피 인건비 총액은 똑같으니까 괜찮겠지...'

'참여연구원 변경은 IRIS에 등록해야 합니다. 미등록 인력 인건비 불인정.'

총액이 같아도 시스템 등록은 필수였습니다.`,

    // 학생인건비 (20-25)
    20: `A재단(기타 비영리기관)에서 대학원생 김연구를 참여연구원으로 섭외했습니다.

'학생이 연구 참여하니까 학생인건비로 지급하면 되겠네!'

'학생인건비는 대학, 정출연 등 특정 기관만 계상 가능합니다. 기타 비영리기관은 대상이 아니에요.'

기관 유형에 따른 학생인건비 계상 가능 여부를 확인해야 했습니다.`,

    21: `○○대학교 연구책임자는 자기 연구실 대학원생 전원을 참여연구원으로 등록했습니다.

'우리 학생들 다 등록해두면 학생인건비 넉넉하게 받을 수 있겠지!'

실제로 연구에 참여하지 않는 학생들도 포함되어 있었습니다.

'실제 과제 참여 여부를 확인했습니다. 비참여 학생 인건비 전액 불인정.'

형식적 등록의 위험성을 알게 되었습니다.`,

    22: `○○대학교에서 학사과정 학생연구원에게 인건비를 지급했습니다.

'학술연구용역 보조원 단가가 229만원이니까 이걸로 계상하자!'

대학 자체 규정의 학사과정 기준은 130만원이었습니다.

'학생인건비는 대학 자체 계상기준을 적용해야 합니다. 초과분 불인정.'

단가 적용의 기준을 정확히 알아야 했습니다.`,

    23: `○○대학교 연구책임자는 우수한 학생연구원에게 여러 과제의 인건비를 지급했습니다.

'이 학생 실력이 좋으니까 여러 과제에서 인건비 받아도 되겠지.'

합산 계상률이 150%가 되었습니다.

'학생연구자도 월별 총 계상률 100% 초과는 불가합니다. 초과분 불인정.'

학생에게도 계상률 제한이 있다는 걸 알게 되었습니다.`,

    24: `○○대학교 A교수는 학생들에게 인건비를 지급한 후 연락했습니다.

'이번 달 인건비 받았지? 연구실 운영비로 좀 돌려줘.'

학생들의 인건비를 회수해서 연구실 공용 물품 구입과 개인 용도로 사용했습니다.

'인건비 부당회수는 중대한 위반입니다. 전액 불인정에 제재 대상.'

학생인건비 회수 금지를 어긴 대가는 컸습니다.`,

    25: `학생인건비 통합관리 대상이 아닌 기관에서 학생인건비를 지급했습니다.

'학생 참여했으니까 인건비 주면 되는 거 아니야?'

연구참여확약서 등 증빙자료를 제출하지 못했습니다.

'통합관리 비대상 기관은 참여 증빙이 필수입니다. 증빙 없는 인건비 불인정.'

증빙서류의 중요성을 깨달았습니다.`,

    // 연구시설장비비 (26-36)
    26: `연구장비 구매 품의를 진행했는데, 장비 납품이 늦어졌습니다.

'단계 종료 일주일 전에 왔으니까 다행이네!'

'연구장비는 종료일 2개월 전까지 검수 완료해야 합니다. 불인정.'

2개월 규정을 몰랐던 것이 화근이었습니다.`,

    27: `영리기관 A사는 연구 시작 전부터 쓰던 연구시설을 임차하고 있었습니다.

'이 임차료도 연구비로 쓰면 되겠지!'

'영리기관이 연구 시작 전부터 임차하던 시설은 현물로만 계상 가능합니다. 현금 집행 불인정.'

영리기관의 기존 시설 계상 규정을 확인해야 했습니다.`,

    28: `연구 수행 중 새로운 장비가 필요해졌습니다.

'3천만원짜리 장비인데, 꼭 필요하니까 그냥 사자!'

원래계획에 없는 장비를 승인 없이 구매했습니다.

'3천만원 이상 신규장비는 사전승인 필수입니다. 불인정.'

3천만원 기준을 기억해야 했습니다.`,

    29: `원래 3천만원 장비가 환율 급등으로 4천만원이 되었습니다.

'불가피한 상황이니까 그냥 구매하자!'

20% 이상 증액인데 승인을 받지 않았습니다.

'3천만원 이상 장비의 20% 초과 증액은 사전승인이 필요합니다. 불인정.'

20% 초과 변경은 승인 대상이었습니다.`,

    30: `95백만원 장비가 가격 인상으로 1억 5백만원이 되었습니다.

'과제 평가 때 이미 심의 받았으니까 괜찮겠지?'

1억원을 넘어서 국가연구시설장비심의위원회 심의 대상이 되었습니다.

'1억원 이상은 심의위원회 심의가 필요합니다. 불인정.'

금액 기준 변경에 따른 심의 필요성을 몰랐습니다.`,

    31: `거래처가 장비를 10일 늦게 납품했습니다.

'그냥 넘어가자. 어차피 받았으니까.'

계약서상 지체상금 조항이 있었는데 청구하지 않았습니다.

'지체상금은 연구비에서 차감해야 합니다. 미청구 금액 불인정.'

지체상금 관리도 정산의 일부였습니다.`,

    32: `영리기관이 7년 전에 구입한 장비를 현물로 계상하려 했습니다.

'아직 내용연수 3년 남았으니까 현물로 넣어도 되겠지!'

'현물 계상 장비는 구입 완료일이 과제 시작일로부터 5년 이내여야 합니다. 불인정.'

5년 기준을 확인하지 않은 실수였습니다.`,

    33: `해외에서 장비를 구매했는데, 통관이 지연되었습니다.

'사업 종료일인데 아직 인천항 창고에 있어요...'

'종료일 2개월 전까지 검수 완료가 안 되었습니다. 불인정.'

해외장비는 통관 기간도 고려해야 했습니다.`,

    34: `연구과제를 수행하면서 새 장비를 구입했습니다.

'연구실에서 쓸 장비니까 연구비로 사면 되겠지!'

해당 과제와 직접 관련이 없는 장비였습니다.

'직접비는 해당 과제와 직접 관련된 비용만 가능합니다. 불인정.'

과제 관련성 입증이 중요했습니다.`,

    35: `연구장비 유지보수 계약을 체결했습니다.

'3년 유지보수 계약이 저렴하니까 한 번에 계약하자!'

연구기간은 1년인데 3년 계약을 했습니다.

'연구기간 종료 후 기간은 연구비로 집행 불가입니다. 초과분 불인정.'

계약 기간과 연구기간의 일치를 확인해야 했습니다.`,

    36: `연구장비 설치 시 부대비용이 발생했습니다.

'설치비, 운송비... 다 장비비로 처리하면 되겠지!'

일부 부대비용이 실제 설치와 무관한 비용이었습니다.

'장비 구입·설치에 직접 필요한 부대비용만 인정됩니다. 무관 비용 불인정.'

부대비용의 범위를 정확히 알아야 했습니다.`,

    // 연구재료비 (37-41)
    37: `연구에 필요한 재료를 분할해서 구매했습니다.

'한 번에 사면 100만원인데, 쪼개서 사면 품의 절차가 간단하잖아.'

'분할발주는 조달 규정 위반입니다. 불인정.'

편의를 위한 분할이 규정 위반이 되었습니다.`,

    38: `연구재료를 연구종료 후에 도착하도록 주문했습니다.

'어차피 논문 쓸 때 필요하니까.'

'연구기간 종료 후 도착한 재료비는 불인정입니다.'

연구기간 내 사용 원칙을 지켜야 했습니다.`,

    39: `연구에 사용할 시약을 대량으로 구매했습니다.

'싸게 살 수 있으니까 많이 사두자!'

실제 연구에 필요한 양을 크게 초과했습니다.

'해당 과제 수행에 필요한 범위를 초과한 구매는 불인정입니다.'

적정 수량 산정이 중요했습니다.`,

    40: `연구재료 구매 후 남은 재료가 있었습니다.

'다음 과제에 쓰면 되지!'

반납 절차 없이 타 과제로 전용했습니다.

'잔여 재료는 반납 또는 정산이 필요합니다. 미반납분 불인정.'

잔여 재료 처리 규정을 확인해야 했습니다.`,

    41: `연구재료 구매 시 업체 선정을 했습니다.

'거래하던 업체가 편하니까 그냥 거기서 사자.'

견적비교 없이 특정 업체에서만 구매했습니다.

'견적비교 등 적정한 업체 선정 절차가 필요합니다. 절차 미흡으로 일부 불인정.'

구매 절차의 투명성이 요구되었습니다.`,

    // 연구활동비 (42-69) - 일부 대표 사례
    42: `해외학술대회에 참석하면서 관광지도 둘러봤습니다.

'학회 끝나고 시간 나니까 좀 둘러보자!'

관광 일정의 숙박비, 식비까지 연구비로 청구했습니다.

'학술활동 기간 외 일정은 연구비 집행 불가입니다. 불인정.'

학술 일정과 사적 일정을 구분해야 했습니다.`,

    43: `출장 시 숙박비를 정산했습니다.

'호텔이 좋으면 컨디션도 좋아지니까!'

기관 규정 단가를 초과한 고급 호텔에 묵었습니다.

'기관 규정 숙박 단가를 초과한 금액은 불인정입니다.'

규정 단가 확인이 필수였습니다.`,

    44: `국내 출장 시 자가용을 이용했습니다.

'편하게 차로 가야지!'

연료비를 실비로 청구했는데, 규정 기준을 초과했습니다.

'자가용 이용 시 기관 규정에 따른 지급 기준이 있습니다. 초과분 불인정.'

자가용 출장비 규정을 확인해야 했습니다.`,

    45: `출장지에서 식사비를 청구했습니다.

'저녁에 회식도 했으니까 같이 넣자!'

연구 관련 없는 개인적 식사까지 포함했습니다.

'연구활동과 직접 관련된 비용만 인정됩니다. 불인정.'

업무 관련성 입증이 필요했습니다.`,

    46: `학술대회 등록비를 결제했습니다.

'내년 학회도 미리 등록하면 할인이니까!'

연구기간 이후 학회 등록비를 선결제했습니다.

'연구기간 내 개최되는 학술대회만 해당됩니다. 불인정.'

학회 개최 시기와 연구기간 확인이 필요했습니다.`,

    47: `연구논문 투고료를 납부했습니다.

'게재료가 비싸지만 좋은 저널이니까!'

출판사에서 부적절한 심사 논란이 있는 저널이었습니다.

'부실학술지 게재료는 인정되지 않을 수 있습니다. 확인 필요.'

저널의 적절성도 검토 대상이었습니다.`,

    48: `전문가 자문료를 지급했습니다.

'교수님께 자문 받았으니까 사례해야지!'

자문 내용과 결과에 대한 기록이 없었습니다.

'자문 결과 보고서 등 증빙이 필요합니다. 미제출 시 불인정.'

자문 증빙 관리가 중요했습니다.`,

    49: `회의비로 식사를 했습니다.

'연구회의니까 회의비로 처리하면 되지!'

회의록이나 참석자 명단이 없었습니다.

'회의 개최 사실 확인 자료가 필요합니다. 불인정.'

회의 증빙서류 구비가 필수였습니다.`,

    50: `세미나 개최비를 집행했습니다.

'세미나 열었으니까 비용 처리하자!'

참석자 대부분이 내부 인원이었고, 외부 공개도 없었습니다.

'연구 목적의 세미나 요건을 갖추어야 합니다. 요건 미충족 시 불인정.'

세미나 개최 요건을 확인해야 했습니다.`,

    51: `수용비로 사무용품을 구매했습니다.

'연구실에서 쓰는 거니까 연구비로!'

연구와 직접 관련 없는 일반 사무용품이었습니다.

'해당 연구과제 수행에 직접 필요한 물품만 인정됩니다. 불인정.'

연구 직접 관련성 확인이 필요했습니다.`,

    52: `인쇄비로 자료를 출력했습니다.

'보고서 인쇄니까 당연히 연구비!'

연구와 무관한 자료까지 인쇄했습니다.

'해당 과제 관련 인쇄만 인정됩니다. 불인정.'

인쇄 내용의 관련성도 확인 대상이었습니다.`,

    53: `시험분석비를 외부기관에 의뢰했습니다.

'전문기관에 맡기면 정확하니까!'

동일 분석을 중복 의뢰했습니다.

'중복 분석 비용은 적정성을 갖추어야 합니다. 불필요한 중복은 불인정.'

분석 의뢰의 필요성 검토가 필요했습니다.`,

    54: `교통비로 택시비를 청구했습니다.

'급하니까 택시 타야지!'

일상적인 출퇴근 택시비까지 포함했습니다.

'연구 목적 이동만 해당됩니다. 출퇴근비 불인정.'

업무용 교통비의 범위를 확인해야 했습니다.`,

    55: `기술정보 수집비로 자료를 구입했습니다.

'연구에 참고할 자료니까!'

연구 분야와 관련 없는 일반 서적이었습니다.

'해당 연구과제와 직접 관련된 자료만 인정됩니다. 불인정.'

자료의 연구 관련성 입증이 필요했습니다.`,

    56: `특허출원 비용을 집행했습니다.

'연구 결과 특허니까 당연히!'

해당 과제와 관련 없는 기존 기술의 특허였습니다.

'해당 과제 연구개발결과물의 특허만 해당됩니다. 불인정.'

특허와 과제의 관련성 확인이 필요했습니다.`,

    57: `연구수행 관련 보험료를 납부했습니다.

'연구 장비 보험이니까!'

연구와 무관한 일반 보험까지 포함했습니다.

'연구수행에 직접 필요한 보험만 인정됩니다. 불인정.'

보험 가입 목적을 명확히 해야 했습니다.`,

    58: `공공요금을 납부했습니다.

'연구실 전기세니까!'

연구실 외 공간의 요금까지 배분했습니다.

'해당 연구과제 수행 공간에 대한 요금만 인정됩니다. 불인정.'

공공요금 배분 기준을 명확히 해야 했습니다.`,

    59: `국외 출장을 다녀왔습니다.

'비행기 비즈니스로 가면 컨디션 좋지!'

기관 규정은 이코노미인데 비즈니스 항공권을 구매했습니다.

'기관 규정 초과분은 불인정입니다.'

항공권 클래스 규정을 확인해야 했습니다.`,

    60: `출장 중 환전 수수료가 발생했습니다.

'환전도 출장 비용이지!'

과도한 환전 수수료를 청구했습니다.

'합리적인 범위의 수수료만 인정됩니다. 과다 수수료 불인정.'

환전 수수료의 적정성도 확인 대상이었습니다.`,

    61: `기자재 임차료를 지급했습니다.

'장비 살 돈이 없으니 빌리자!'

연구기간을 초과하는 장기 임차 계약을 했습니다.

'연구기간 내 임차 기간만 인정됩니다. 초과분 불인정.'

임차 기간과 연구기간의 일치를 확인해야 했습니다.`,

    62: `전산처리비로 클라우드 서비스를 이용했습니다.

'데이터 분석에 필요하니까!'

개인용 서비스까지 연구비로 결제했습니다.

'연구 목적 서비스만 해당됩니다. 불인정.'

서비스 사용 목적을 명확히 해야 했습니다.`,

    63: `연구실 안전관리비를 집행했습니다.

'안전 관리도 연구에 필요하지!'

법정 의무가 아닌 추가 안전장비를 과다 구매했습니다.

'적정 범위의 안전관리비만 인정됩니다. 과다분 불인정.'

안전관리비의 적정성 검토가 필요했습니다.`,

    64: `기술도입비로 소프트웨어 라이선스를 구매했습니다.

'연구에 쓸 프로그램이니까!'

연구와 무관한 일반 업무용 소프트웨어였습니다.

'해당 연구과제 수행에 직접 필요한 기술만 인정됩니다. 불인정.'

소프트웨어의 연구 관련성 확인이 필요했습니다.`,

    65: `연구윤리 교육비를 집행했습니다.

'연구원 교육이니까!'

연구와 무관한 일반 직무교육까지 포함했습니다.

'해당 연구과제 관련 교육만 인정됩니다. 불인정.'

교육의 연구 관련성을 확인해야 했습니다.`,

    66: `연구개발 서비스 이용료를 지급했습니다.

'외부 용역이니까!'

연구 내용과 맞지 않는 서비스를 이용했습니다.

'연구개발 목적에 부합하는 서비스만 인정됩니다. 불인정.'

서비스와 연구의 관련성 입증이 필요했습니다.`,

    67: `연구실 환경개선비를 사용했습니다.

'연구환경 개선도 필요하지!'

연구와 무관한 인테리어 비용이었습니다.

'직접비로 연구환경 개선비는 인정되지 않습니다. 불인정.'

직접비 사용 용도를 확인해야 했습니다.`,

    68: `회의 참석자에게 기념품을 제공했습니다.

'참석해 주셨으니 감사 표시로!'

고가의 기념품을 연구비로 구매했습니다.

'회의비 목적에 맞지 않는 기념품은 불인정입니다.'

회의비 사용 범위를 확인해야 했습니다.`,

    69: `연구 홍보비로 판촉물을 제작했습니다.

'연구 성과 홍보니까!'

연구 내용과 무관한 일반 홍보물이었습니다.

'해당 연구과제 성과 홍보 목적만 인정됩니다. 불인정.'

홍보 내용의 과제 관련성 확인이 필요했습니다.`,

    // 연구수당 (70-77)
    70: `연구수당을 분기별로 지급했습니다.

'연구 열심히 하니까 연구수당 주자!'

직접비 사용실적 비율을 초과해서 지급했습니다.

'연구수당은 직접비 사용실적에 비례해서 지급해야 합니다. 초과분 불인정.'

연구수당 지급 비율 규정을 확인해야 했습니다.`,

    71: `비참여연구원에게 연구수당을 지급했습니다.

'같은 연구실이니까 나눠주자!'

과제에 참여하지 않는 인원이 포함되었습니다.

'참여연구자에게만 지급 가능합니다. 비참여자분 불인정.'

참여연구원 여부 확인이 필수였습니다.`,

    72: `연구수당을 현금이 아닌 현물로 지급했습니다.

'상품권으로 주면 편하지!'

현금 지급 원칙을 위반했습니다.

'연구수당은 현금으로 지급해야 합니다. 현물 지급 불인정.'

지급 방식 규정을 확인해야 했습니다.`,

    73: `연구수당 지급 시 증빙을 갖추지 않았습니다.

'그냥 계좌이체하면 되지!'

지급대장, 지급조서 등이 없었습니다.

'연구수당 지급 증빙이 필요합니다. 미비 시 불인정.'

증빙서류 관리가 중요했습니다.`,

    74: `연구책임자에게 연구수당을 과다 지급했습니다.

'책임자니까 많이 받아야지!'

지급 상한을 초과했습니다.

'연구수당 지급 상한이 있습니다. 초과분 불인정.'

지급 한도를 확인해야 했습니다.`,

    75: `연구 종료 후 연구수당을 지급했습니다.

'정산하면서 남은 거 연구수당으로 나눠주자!'

연구기간 종료 후 지급했습니다.

'연구기간 내 지급해야 합니다. 종료 후 지급 불인정.'

지급 시기 규정을 확인해야 했습니다.`,

    76: `인건비 계상 연구원에게도 연구수당을 지급했습니다.

'인건비도 받고 연구수당도 받으면 좋지!'

이중 지급에 해당했습니다.

'중복 지급 여부를 확인해야 합니다. 부적정 지급 불인정.'

지급 대상 요건을 확인해야 했습니다.`,

    77: `연구수당을 계상하면서 산정 근거가 불명확했습니다.

'대충 이 정도면 되겠지!'

산정 기준과 근거가 없었습니다.

'연구수당 산정 근거가 필요합니다. 근거 불명확 시 불인정.'

산정 기준을 명확히 해야 했습니다.`,

    // 위탁연구개발비 (78-82)
    78: `위탁연구기관 선정 시 경쟁 없이 특정 기관을 선정했습니다.

'저번에 같이 했던 곳이 편하지!'

선정 절차와 근거가 부족했습니다.

'위탁기관 선정의 타당성 근거가 필요합니다. 절차 미흡 시 불인정.'

선정 절차의 적정성 확인이 필요했습니다.`,

    79: `위탁연구 수행 내용이 원래 계획과 달랐습니다.

'비슷한 거니까 괜찮겠지!'

연구개발계획서와 실제 수행 내용이 불일치했습니다.

'계획과 실제 수행 내용이 일치해야 합니다. 불일치분 불인정.'

위탁 내용 관리가 중요했습니다.`,

    80: `위탁연구기관에서 간접비를 과다 계상했습니다.

'위탁기관도 간접비 필요하지!'

위탁연구비의 간접비 상한을 초과했습니다.

'위탁연구비 간접비 비율 제한이 있습니다. 초과분 불인정.'

간접비 비율 규정을 확인해야 했습니다.`,

    81: `위탁연구 정산 시 증빙이 부족했습니다.

'위탁기관에서 알아서 했겠지!'

세부 집행 내역 확인이 안 되었습니다.

'위탁연구비도 증빙 확인이 필요합니다. 증빙 미비 시 불인정.'

위탁비 정산 관리가 필요했습니다.`,

    82: `위탁연구 결과물이 제출되지 않았습니다.

'연구는 했으니까!'

결과보고서 등 결과물이 없었습니다.

'위탁연구 결과물 제출은 필수입니다. 미제출 시 불인정.'

결과물 관리가 중요했습니다.`,

    // 국제공동연구개발비 (83-86)
    83: `국제공동연구 분담금을 과다 지급했습니다.

'국제협력이니까 좀 더 줘야지!'

협약상 분담금을 초과했습니다.

'협약에 따른 분담금만 인정됩니다. 초과분 불인정.'

협약 내용을 정확히 확인해야 했습니다.`,

    84: `국제공동연구 체결 없이 비용을 집행했습니다.

'나중에 협약하면 되지!'

협약 전에 비용을 선집행했습니다.

'국제공동연구 협약 체결 후 집행해야 합니다. 선집행 불인정.'

협약 시기를 확인해야 했습니다.`,

    85: `국제공동연구 상대국 지출 증빙이 없었습니다.

'외국이라 증빙 받기 어려워요!'

해외 지출 증빙이 미비했습니다.

'해외 지출도 증빙이 필요합니다. 미비 시 불인정.'

해외 증빙 관리 방안이 필요했습니다.`,

    86: `국제공동연구비를 국내 용도로 사용했습니다.

'남는 거 국내 연구에 쓰면 되지!'

국제협력 목적 외 사용이었습니다.

'국제공동연구개발비 목적에 맞게 사용해야 합니다. 목적 외 사용 불인정.'

비목 간 용도 구분을 지켜야 했습니다.`,

    // 간접비 (87-99)
    87: `간접비로 기관 공통 경비를 집행했습니다.

'기관 운영비니까!'

연구개발과제와 무관한 경비까지 포함했습니다.

'연구개발활동 지원 목적만 인정됩니다. 무관 경비 불인정.'

간접비 사용 범위를 확인해야 했습니다.`,

    88: `간접비 중 인력지원비를 과다 사용했습니다.

'지원인력 급여도 간접비로!'

인력지원비 비율을 초과했습니다.

'인력지원비 사용 비율 제한이 있습니다. 초과분 불인정.'

간접비 세부항목 비율을 확인해야 했습니다.`,

    89: `간접비로 연구실 안전관리비를 집행했습니다.

'안전관리도 필요하지!'

법정 의무 외 과다한 안전비용이었습니다.

'적정 범위의 안전관리비만 인정됩니다. 과다분 불인정.'

안전관리비 적정성을 검토해야 했습니다.`,

    90: `간접비를 직접비 용도로 사용했습니다.

'돈이 부족하니까!'

간접비를 연구재료 구입에 사용했습니다.

'간접비와 직접비 용도는 구분됩니다. 용도 위반 불인정.'

비목 간 구분을 지켜야 했습니다.`,

    91: `간접비 정산 시 집행 내역이 불명확했습니다.

'간접비는 대충 써도 되지!'

세부 집행 내역이 없었습니다.

'간접비도 집행 내역 관리가 필요합니다. 불명확 시 불인정.'

간접비 관리의 중요성을 알게 되었습니다.`,

    92: `간접비로 기관 건물 임차료를 과다 배분했습니다.

'연구실도 건물에 있으니까!'

실제 연구공간 비율을 초과했습니다.

'연구공간에 해당하는 부분만 인정됩니다. 과다배분 불인정.'

배분 기준을 명확히 해야 했습니다.`,

    93: `간접비로 연구기관 운영비를 사용했습니다.

'기관 운영도 연구 지원이지!'

연구와 무관한 일반 운영비였습니다.

'연구개발활동 지원 목적만 해당됩니다. 불인정.'

간접비 사용 목적을 확인해야 했습니다.`,

    94: `간접비 비율을 초과해서 계상했습니다.

'간접비 많으면 좋지!'

규정 비율을 초과했습니다.

'간접비 비율 상한이 있습니다. 초과분 불인정.'

간접비 비율 규정을 확인해야 했습니다.`,

    95: `간접비로 성과활용지원비를 사용했습니다.

'성과 홍보도 필요하지!'

연구성과와 무관한 홍보비였습니다.

'해당 과제 성과활용 목적만 인정됩니다. 불인정.'

성과활용 관련성을 입증해야 했습니다.`,

    96: `간접비로 연구개발준비금을 과다 적립했습니다.

'미래 연구를 위해!'

적립 한도를 초과했습니다.

'연구개발준비금 적립 한도가 있습니다. 초과분 불인정.'

적립 한도를 확인해야 했습니다.`,

    97: `간접비 사용 시 증빙을 갖추지 않았습니다.

'간접비는 증빙 없어도 되지!'

사용 증빙이 없었습니다.

'간접비도 증빙 관리가 필요합니다. 미비 시 불인정.'

증빙 관리의 중요성을 알게 되었습니다.`,

    98: `간접비를 타 과제에 사용했습니다.

'어차피 같은 기관이니까!'

해당 과제 외 용도로 사용했습니다.

'해당 연구개발과제 지원 목적으로만 사용해야 합니다. 불인정.'

과제별 관리의 중요성을 알게 되었습니다.`,

    99: `간접비로 인센티브를 과다 지급했습니다.

'연구 잘했으니까!'

인센티브 지급 기준을 초과했습니다.

'인센티브 지급 기준이 있습니다. 초과분 불인정.'

지급 기준을 확인해야 했습니다.`,

    // 기타 (100-105)
    100: `이월된 연구비를 목적 외로 사용했습니다.

'이월됐으니 자유롭게 쓰면 되지!'

이월 승인 목적과 다르게 사용했습니다.

'이월 목적에 맞게 사용해야 합니다. 목적 외 사용 불인정.'

이월비 사용 목적을 확인해야 했습니다.`,

    101: `연구비 집행 시 영수증을 분실했습니다.

'잃어버렸는데 어쩌지...'

증빙서류가 없었습니다.

'모든 집행은 증빙이 필요합니다. 미비 시 불인정.'

증빙 관리의 중요성을 깨달았습니다.`,

    102: `카드 결제 후 취소/환불을 받았는데 미신고했습니다.

'조금인데 그냥 넘어가지!'

환불액을 연구비에서 차감하지 않았습니다.

'환불액은 연구비에서 차감해야 합니다. 미차감 시 불인정.'

환불 처리 절차를 지켜야 했습니다.`,

    103: `연구비로 개인 물품을 구매했습니다.

'연구실에서 쓰니까 괜찮지!'

명백히 개인 용도 물품이었습니다.

'연구 목적 물품만 구매 가능합니다. 불인정.'

구매 목적의 적정성을 확인해야 했습니다.`,

    104: `허위 증빙으로 연구비를 집행했습니다.

'이 정도는 괜찮겠지...'

위조된 영수증이 발견되었습니다.

'허위 증빙은 연구비 환수 및 제재 대상입니다.'

허위 증빙의 심각성을 알게 되었습니다.`,

    105: `정산 기한을 넘겨서 보고했습니다.

'조금 늦어도 되겠지!'

정산 보고 기한을 초과했습니다.

'정산 기한 준수는 필수입니다. 지연 시 불이익 발생.'

기한 관리의 중요성을 알게 되었습니다.`,
};

// Read CSV
const csvPath = path.join(__dirname, '..', '사례집_데이터_전체.csv');
const csvContent = fs.readFileSync(csvPath, 'utf8');
const data = parseCSV(csvContent);

// Add stories to data
let updatedCount = 0;
for (let i = 1; i < data.length; i++) {
    const row = data[i];
    const id = parseInt(row[0]);
    const currentStory = row[8] || '';

    // If no story exists and we have one in our templates
    if (currentStory.trim().length < 10 && stories[id]) {
        row[8] = stories[id];
        updatedCount++;
    }
}

// Convert back to CSV
const csvOutput = data.map(row => row.map(escapeCSV).join(',')).join('\n');

// Write updated CSV
fs.writeFileSync(csvPath, csvOutput, 'utf8');

console.log(`스토리텔링 추가 완료: ${updatedCount}개 사례`);
console.log('파일 저장: 사례집_데이터_전체.csv');
